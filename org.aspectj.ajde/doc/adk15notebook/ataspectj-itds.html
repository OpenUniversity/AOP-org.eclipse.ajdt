<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Inter-type Declarations</title><link rel="stylesheet" href="aspectj-docs.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.44"><link rel="home" href="index.html" title="The AspectJTM 5 Development Kit Developer's Notebook"><link rel="up" href="ataspectj.html" title="Chapter 9. An Annotation Based Development Style"><link rel="previous" href="ataspectj-pcadvice.html" title="Pointcuts and Advice"><link rel="next" href="ataspectj-declare.html" title="Declare statements"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Inter-type Declarations</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ataspectj-pcadvice.html">Prev</a>&nbsp;</td><th width="60%" align="center">Chapter 9. An Annotation Based Development Style</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="ataspectj-declare.html">Next</a></td></tr></table><hr></div><div class="sect1"><a name="ataspectj-itds"></a><div class="titlepage"><div><h2 class="title" style="clear: both"><a name="ataspectj-itds"></a>Inter-type Declarations</h2></div></div><p>
      Inter-type declarations are challenging to support using an annotation style.
      It's very important to preserve the exact same semantics between the code style
      and the annotation style. We also want to support compilation of a large set
      of AspectJ applications using a standard Java 5 compiler. For these reasons, in
      the initial release of AspectJ 5 we will only support inter-type declarations
      on interfaces using the annotation style.
        </p><p>
      Consider the following aspect:
        </p><pre class="programlisting">
     public aspect MoodIndicator {

        public interface Moody {};

        private Mood Moody.mood = Mood.HAPPY;

        public Mood Moody.getMood() {
          return mood;
        }

        declare parents : org.xyz..* implements Moody;

        before(Moody m) : execution(* *.*(..)) &amp;&amp; this(m) {
           System.out.println("I'm feeling " + m.getMood());
        }
     }
         </pre><p>
      This declares an interface
            <tt>Moody</tt>, and then makes two
      inter-type declarations on the interface - a field that is private to the
      aspect, and a method that returns the mood. Within the body of the inter-type
      declared method
            <tt>getMoody</tt>, the type of
            <tt>this</tt>
      is
            <tt>Moody</tt> (the target type of the inter-type declaration).
        </p><p>Using the annotation style this aspect can be written:
        </p><pre class="programlisting">
     @Aspect
     public class MoodIndicator {

        public interface Moody {
          Mood getMood();
        };

        @DeclareParents("org.xzy..*")
        class MoodyImpl implements Moody {
           private Mood mood = Mood.HAPPY;

           public Mood getMood() {
             return mood;
           }
        }

        @Before("execution(* *.*(..)) &amp;&amp; this(m)")
        void feelingMoody(Moody m) {
           System.out.println("I'm feeling " + m.getMood());
        }
     }
         </pre><p>
      This is very similar to the mixin mechanism supported by AspectWerkz. The 
      effect of the
            <tt>@DeclareParents</tt> annotation is equivalent to
      a declare parents statement that all types matching the type pattern implement
      the interface implemented by the annotated class. In addition, the member
      declarations within the annotated class are treated as inter-type declarations
      on the implemented interface. Note how this scheme operates within the constraints
      of Java type checking and ensures that
            <tt>this</tt> has access
      to the exact same set of members as in the code style example.
        </p><p>The annotated class may only extend
            <tt>Object</tt>, and may
      only implement a single interface. The interface implemented by the class may
      itself extend other interfaces.
        </p></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ataspectj-pcadvice.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="ataspectj-declare.html">Next</a></td></tr><tr><td width="40%" align="left">Pointcuts and Advice&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="ataspectj.html">Up</a></td><td width="40%" align="right">&nbsp;Declare statements</td></tr></table></div></body></html>